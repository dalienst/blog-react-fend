{"ast":null,"code":"import { error, doneInvoke } from './actions.js';\nimport { toActorRef } from './Actor.js';\nimport { toObserver } from './utils.js';\n/**\r\n * Returns an actor behavior from a reducer and its initial state.\r\n *\r\n * @param transition The pure reducer that returns the next state given the current state and event.\r\n * @param initialState The initial state of the reducer.\r\n * @returns An actor behavior\r\n */\n\nfunction fromReducer(transition, initialState) {\n  return {\n    transition: transition,\n    initialState: initialState\n  };\n}\n\nfunction fromPromise(promiseFn) {\n  var initialState = {\n    error: undefined,\n    data: undefined,\n    status: 'pending'\n  };\n  return {\n    transition: function (state, event, _a) {\n      var parent = _a.parent,\n          id = _a.id,\n          observers = _a.observers;\n\n      switch (event.type) {\n        case 'fulfill':\n          parent === null || parent === void 0 ? void 0 : parent.send(doneInvoke(id, event.data));\n          return {\n            error: undefined,\n            data: event.data,\n            status: 'fulfilled'\n          };\n\n        case 'reject':\n          parent === null || parent === void 0 ? void 0 : parent.send(error(id, event.error));\n          observers.forEach(function (observer) {\n            observer.error(event.error);\n          });\n          return {\n            error: event.error,\n            data: undefined,\n            status: 'rejected'\n          };\n\n        default:\n          return state;\n      }\n    },\n    initialState: initialState,\n    start: function (_a) {\n      var self = _a.self;\n      promiseFn().then(function (data) {\n        self.send({\n          type: 'fulfill',\n          data: data\n        });\n      }, function (reason) {\n        self.send({\n          type: 'reject',\n          error: reason\n        });\n      });\n      return initialState;\n    }\n  };\n}\n\nfunction spawnBehavior(behavior, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var state = behavior.initialState;\n  var observers = new Set();\n  var mailbox = [];\n  var flushing = false;\n\n  var flush = function () {\n    if (flushing) {\n      return;\n    }\n\n    flushing = true;\n\n    while (mailbox.length > 0) {\n      var event_1 = mailbox.shift();\n      state = behavior.transition(state, event_1, actorCtx);\n      observers.forEach(function (observer) {\n        return observer.next(state);\n      });\n    }\n\n    flushing = false;\n  };\n\n  var actor = toActorRef({\n    id: options.id,\n    send: function (event) {\n      mailbox.push(event);\n      flush();\n    },\n    getSnapshot: function () {\n      return state;\n    },\n    subscribe: function (next, handleError, complete) {\n      var observer = toObserver(next, handleError, complete);\n      observers.add(observer);\n      observer.next(state);\n      return {\n        unsubscribe: function () {\n          observers.delete(observer);\n        }\n      };\n    }\n  });\n  var actorCtx = {\n    parent: options.parent,\n    self: actor,\n    id: options.id || 'anonymous',\n    observers: observers\n  };\n  state = behavior.start ? behavior.start(actorCtx) : state;\n  return actor;\n}\n\nexport { fromPromise, fromReducer, spawnBehavior };","map":{"version":3,"sources":["/home/dalienst/node_modules/xstate/es/behaviors.js"],"names":["error","doneInvoke","toActorRef","toObserver","fromReducer","transition","initialState","fromPromise","promiseFn","undefined","data","status","state","event","_a","parent","id","observers","type","send","forEach","observer","start","self","then","reason","spawnBehavior","behavior","options","Set","mailbox","flushing","flush","length","event_1","shift","actorCtx","next","actor","push","getSnapshot","subscribe","handleError","complete","add","unsubscribe","delete"],"mappings":"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","sourcesContent":["import { error, doneInvoke } from './actions.js';\nimport { toActorRef } from './Actor.js';\nimport { toObserver } from './utils.js';\n\n/**\r\n * Returns an actor behavior from a reducer and its initial state.\r\n *\r\n * @param transition The pure reducer that returns the next state given the current state and event.\r\n * @param initialState The initial state of the reducer.\r\n * @returns An actor behavior\r\n */\n\nfunction fromReducer(transition, initialState) {\n  return {\n    transition: transition,\n    initialState: initialState\n  };\n}\nfunction fromPromise(promiseFn) {\n  var initialState = {\n    error: undefined,\n    data: undefined,\n    status: 'pending'\n  };\n  return {\n    transition: function (state, event, _a) {\n      var parent = _a.parent,\n          id = _a.id,\n          observers = _a.observers;\n\n      switch (event.type) {\n        case 'fulfill':\n          parent === null || parent === void 0 ? void 0 : parent.send(doneInvoke(id, event.data));\n          return {\n            error: undefined,\n            data: event.data,\n            status: 'fulfilled'\n          };\n\n        case 'reject':\n          parent === null || parent === void 0 ? void 0 : parent.send(error(id, event.error));\n          observers.forEach(function (observer) {\n            observer.error(event.error);\n          });\n          return {\n            error: event.error,\n            data: undefined,\n            status: 'rejected'\n          };\n\n        default:\n          return state;\n      }\n    },\n    initialState: initialState,\n    start: function (_a) {\n      var self = _a.self;\n      promiseFn().then(function (data) {\n        self.send({\n          type: 'fulfill',\n          data: data\n        });\n      }, function (reason) {\n        self.send({\n          type: 'reject',\n          error: reason\n        });\n      });\n      return initialState;\n    }\n  };\n}\nfunction spawnBehavior(behavior, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var state = behavior.initialState;\n  var observers = new Set();\n  var mailbox = [];\n  var flushing = false;\n\n  var flush = function () {\n    if (flushing) {\n      return;\n    }\n\n    flushing = true;\n\n    while (mailbox.length > 0) {\n      var event_1 = mailbox.shift();\n      state = behavior.transition(state, event_1, actorCtx);\n      observers.forEach(function (observer) {\n        return observer.next(state);\n      });\n    }\n\n    flushing = false;\n  };\n\n  var actor = toActorRef({\n    id: options.id,\n    send: function (event) {\n      mailbox.push(event);\n      flush();\n    },\n    getSnapshot: function () {\n      return state;\n    },\n    subscribe: function (next, handleError, complete) {\n      var observer = toObserver(next, handleError, complete);\n      observers.add(observer);\n      observer.next(state);\n      return {\n        unsubscribe: function () {\n          observers.delete(observer);\n        }\n      };\n    }\n  });\n  var actorCtx = {\n    parent: options.parent,\n    self: actor,\n    id: options.id || 'anonymous',\n    observers: observers\n  };\n  state = behavior.start ? behavior.start(actorCtx) : state;\n  return actor;\n}\n\nexport { fromPromise, fromReducer, spawnBehavior };\n"]},"metadata":{},"sourceType":"module"}