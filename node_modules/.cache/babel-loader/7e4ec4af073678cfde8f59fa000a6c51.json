{"ast":null,"code":"import { __assign, __read } from \"tslib\";\nimport { DOT_PATTERN, getArnResources, getSuffix, getSuffixForArnEndpoint, isBucketNameOptions, isDnsCompatibleBucketName, validateAccountId, validateArnEndpointOptions, validateDNSHostLabel, validateNoDualstack, validateNoFIPS, validateOutpostService, validatePartition, validateRegion, validateS3Service, validateService } from \"./bucketHostnameUtils\";\nexport var bucketHostname = function (options) {\n  var isCustomEndpoint = options.isCustomEndpoint,\n      baseHostname = options.baseHostname,\n      dualstackEndpoint = options.dualstackEndpoint,\n      accelerateEndpoint = options.accelerateEndpoint;\n\n  if (isCustomEndpoint) {\n    if (dualstackEndpoint) throw new Error(\"Dualstack endpoint is not supported with custom endpoint\");\n    if (accelerateEndpoint) throw new Error(\"Accelerate endpoint is not supported with custom endpoint\");\n  }\n\n  return isBucketNameOptions(options) ? // Construct endpoint when bucketName is a string referring to a bucket name\n  getEndpointFromBucketName(__assign(__assign({}, options), {\n    isCustomEndpoint: isCustomEndpoint\n  })) : // Construct endpoint when bucketName is an ARN referring to an S3 resource like Access Point\n  getEndpointFromArn(__assign(__assign({}, options), {\n    isCustomEndpoint: isCustomEndpoint\n  }));\n};\n\nvar getEndpointFromArn = function (options) {\n  var isCustomEndpoint = options.isCustomEndpoint,\n      baseHostname = options.baseHostname;\n\n  var _a = __read(isCustomEndpoint ? [options.clientRegion, baseHostname] : // Infer client region and hostname suffix from hostname from endpoints.json, like `s3.us-west-2.amazonaws.com`\n  getSuffixForArnEndpoint(baseHostname), 2),\n      clientRegion = _a[0],\n      hostnameSuffix = _a[1];\n\n  var pathStyleEndpoint = options.pathStyleEndpoint,\n      _b = options.dualstackEndpoint,\n      dualstackEndpoint = _b === void 0 ? false : _b,\n      _c = options.accelerateEndpoint,\n      accelerateEndpoint = _c === void 0 ? false : _c,\n      _d = options.tlsCompatible,\n      tlsCompatible = _d === void 0 ? true : _d,\n      useArnRegion = options.useArnRegion,\n      bucketName = options.bucketName,\n      _e = options.clientPartition,\n      clientPartition = _e === void 0 ? \"aws\" : _e,\n      _f = options.clientSigningRegion,\n      clientSigningRegion = _f === void 0 ? clientRegion : _f;\n  validateArnEndpointOptions({\n    pathStyleEndpoint: pathStyleEndpoint,\n    accelerateEndpoint: accelerateEndpoint,\n    tlsCompatible: tlsCompatible\n  }); // Validate and parse the ARN supplied as a bucket name\n\n  var service = bucketName.service,\n      partition = bucketName.partition,\n      accountId = bucketName.accountId,\n      region = bucketName.region,\n      resource = bucketName.resource;\n  validateService(service);\n  validatePartition(partition, {\n    clientPartition: clientPartition\n  });\n  validateAccountId(accountId);\n  validateRegion(region, {\n    useArnRegion: useArnRegion,\n    clientRegion: clientRegion,\n    clientSigningRegion: clientSigningRegion\n  });\n\n  var _g = getArnResources(resource),\n      accesspointName = _g.accesspointName,\n      outpostId = _g.outpostId;\n\n  validateDNSHostLabel(accesspointName + \"-\" + accountId, {\n    tlsCompatible: tlsCompatible\n  });\n  var endpointRegion = useArnRegion ? region : clientRegion;\n  var signingRegion = useArnRegion ? region : clientSigningRegion;\n\n  if (outpostId) {\n    // if this is an Outpost ARN\n    validateOutpostService(service);\n    validateDNSHostLabel(outpostId, {\n      tlsCompatible: tlsCompatible\n    });\n    validateNoDualstack(dualstackEndpoint);\n    validateNoFIPS(endpointRegion);\n    var hostnamePrefix_1 = accesspointName + \"-\" + accountId + \".\" + outpostId;\n    return {\n      bucketEndpoint: true,\n      hostname: \"\" + hostnamePrefix_1 + (isCustomEndpoint ? \"\" : \".s3-outposts.\" + endpointRegion) + \".\" + hostnameSuffix,\n      signingRegion: signingRegion,\n      signingService: \"s3-outposts\"\n    };\n  } // construct endpoint from Accesspoint ARN\n\n\n  validateS3Service(service);\n  var hostnamePrefix = accesspointName + \"-\" + accountId;\n  return {\n    bucketEndpoint: true,\n    hostname: \"\" + hostnamePrefix + (isCustomEndpoint ? \"\" : \".s3-accesspoint\" + (dualstackEndpoint ? \".dualstack\" : \"\") + \".\" + endpointRegion) + \".\" + hostnameSuffix,\n    signingRegion: signingRegion\n  };\n};\n\nvar getEndpointFromBucketName = function (_a) {\n  var _b = _a.accelerateEndpoint,\n      accelerateEndpoint = _b === void 0 ? false : _b,\n      region = _a.clientRegion,\n      baseHostname = _a.baseHostname,\n      bucketName = _a.bucketName,\n      _c = _a.dualstackEndpoint,\n      dualstackEndpoint = _c === void 0 ? false : _c,\n      _d = _a.pathStyleEndpoint,\n      pathStyleEndpoint = _d === void 0 ? false : _d,\n      _e = _a.tlsCompatible,\n      tlsCompatible = _e === void 0 ? true : _e,\n      _f = _a.isCustomEndpoint,\n      isCustomEndpoint = _f === void 0 ? false : _f;\n\n  var _g = __read(isCustomEndpoint ? [region, baseHostname] : getSuffix(baseHostname), 2),\n      clientRegion = _g[0],\n      hostnameSuffix = _g[1];\n\n  if (pathStyleEndpoint || !isDnsCompatibleBucketName(bucketName) || tlsCompatible && DOT_PATTERN.test(bucketName)) {\n    return {\n      bucketEndpoint: false,\n      hostname: dualstackEndpoint ? \"s3.dualstack.\" + clientRegion + \".\" + hostnameSuffix : baseHostname\n    };\n  }\n\n  if (accelerateEndpoint) {\n    baseHostname = \"s3-accelerate\" + (dualstackEndpoint ? \".dualstack\" : \"\") + \".\" + hostnameSuffix;\n  } else if (dualstackEndpoint) {\n    baseHostname = \"s3.dualstack.\" + clientRegion + \".\" + hostnameSuffix;\n  }\n\n  return {\n    bucketEndpoint: true,\n    hostname: bucketName + \".\" + baseHostname\n  };\n};","map":{"version":3,"mappings":"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","names":["DOT_PATTERN","getArnResources","getSuffix","getSuffixForArnEndpoint","isBucketNameOptions","isDnsCompatibleBucketName","validateAccountId","validateArnEndpointOptions","validateDNSHostLabel","validateNoDualstack","validateNoFIPS","validateOutpostService","validatePartition","validateRegion","validateS3Service","validateService","bucketHostname","options","baseHostname","dualstackEndpoint","accelerateEndpoint","isCustomEndpoint","Error","getEndpointFromBucketName","getEndpointFromArn","clientRegion","hostnameSuffix","_b","_c","_d","tlsCompatible","useArnRegion","bucketName","_e","clientPartition","_f","clientSigningRegion","pathStyleEndpoint","partition","accountId","region","resource","service","accesspointName","outpostId","endpointRegion","signingRegion","hostnamePrefix_1","bucketEndpoint","hostname","signingService","hostnamePrefix","_a","test"],"sources":["/home/dalienst/node_modules/@aws-sdk/middleware-bucket-endpoint/src/bucketHostname.ts"],"sourcesContent":["import {\n  ArnHostnameParams,\n  BucketHostnameParams,\n  DOT_PATTERN,\n  getArnResources,\n  getSuffix,\n  getSuffixForArnEndpoint,\n  isBucketNameOptions,\n  isDnsCompatibleBucketName,\n  validateAccountId,\n  validateArnEndpointOptions,\n  validateDNSHostLabel,\n  validateNoDualstack,\n  validateNoFIPS,\n  validateOutpostService,\n  validatePartition,\n  validateRegion,\n  validateS3Service,\n  validateService,\n} from \"./bucketHostnameUtils\";\n\nexport interface BucketHostname {\n  hostname: string;\n  bucketEndpoint: boolean;\n  signingRegion?: string;\n  signingService?: string;\n}\n\nexport const bucketHostname = (options: BucketHostnameParams | ArnHostnameParams): BucketHostname => {\n  const { isCustomEndpoint, baseHostname, dualstackEndpoint, accelerateEndpoint } = options;\n\n  if (isCustomEndpoint) {\n    if (dualstackEndpoint) throw new Error(\"Dualstack endpoint is not supported with custom endpoint\");\n    if (accelerateEndpoint) throw new Error(\"Accelerate endpoint is not supported with custom endpoint\");\n  }\n\n  return isBucketNameOptions(options)\n    ? // Construct endpoint when bucketName is a string referring to a bucket name\n      getEndpointFromBucketName({ ...options, isCustomEndpoint })\n    : // Construct endpoint when bucketName is an ARN referring to an S3 resource like Access Point\n      getEndpointFromArn({ ...options, isCustomEndpoint });\n};\n\nconst getEndpointFromArn = (options: ArnHostnameParams & { isCustomEndpoint: boolean }): BucketHostname => {\n  const { isCustomEndpoint, baseHostname } = options;\n  const [clientRegion, hostnameSuffix] = isCustomEndpoint\n    ? [options.clientRegion, baseHostname]\n    : // Infer client region and hostname suffix from hostname from endpoints.json, like `s3.us-west-2.amazonaws.com`\n      getSuffixForArnEndpoint(baseHostname);\n\n  const {\n    pathStyleEndpoint,\n    dualstackEndpoint = false,\n    accelerateEndpoint = false,\n    tlsCompatible = true,\n    useArnRegion,\n    bucketName,\n    clientPartition = \"aws\",\n    clientSigningRegion = clientRegion,\n  } = options;\n\n  validateArnEndpointOptions({ pathStyleEndpoint, accelerateEndpoint, tlsCompatible });\n\n  // Validate and parse the ARN supplied as a bucket name\n  const { service, partition, accountId, region, resource } = bucketName;\n  validateService(service);\n  validatePartition(partition, { clientPartition });\n  validateAccountId(accountId);\n  validateRegion(region, { useArnRegion, clientRegion, clientSigningRegion });\n  const { accesspointName, outpostId } = getArnResources(resource);\n  validateDNSHostLabel(`${accesspointName}-${accountId}`, { tlsCompatible });\n\n  const endpointRegion = useArnRegion ? region : clientRegion;\n  const signingRegion = useArnRegion ? region : clientSigningRegion;\n  if (outpostId) {\n    // if this is an Outpost ARN\n    validateOutpostService(service);\n    validateDNSHostLabel(outpostId, { tlsCompatible });\n    validateNoDualstack(dualstackEndpoint);\n    validateNoFIPS(endpointRegion);\n    const hostnamePrefix = `${accesspointName}-${accountId}.${outpostId}`;\n    return {\n      bucketEndpoint: true,\n      hostname: `${hostnamePrefix}${isCustomEndpoint ? \"\" : `.s3-outposts.${endpointRegion}`}.${hostnameSuffix}`,\n      signingRegion,\n      signingService: \"s3-outposts\",\n    };\n  }\n  // construct endpoint from Accesspoint ARN\n  validateS3Service(service);\n  const hostnamePrefix = `${accesspointName}-${accountId}`;\n  return {\n    bucketEndpoint: true,\n    hostname: `${hostnamePrefix}${\n      isCustomEndpoint ? \"\" : `.s3-accesspoint${dualstackEndpoint ? \".dualstack\" : \"\"}.${endpointRegion}`\n    }.${hostnameSuffix}`,\n    signingRegion,\n  };\n};\n\nconst getEndpointFromBucketName = ({\n  accelerateEndpoint = false,\n  clientRegion: region,\n  baseHostname,\n  bucketName,\n  dualstackEndpoint = false,\n  pathStyleEndpoint = false,\n  tlsCompatible = true,\n  isCustomEndpoint = false,\n}: BucketHostnameParams & { isCustomEndpoint: boolean }): BucketHostname => {\n  const [clientRegion, hostnameSuffix] = isCustomEndpoint ? [region, baseHostname] : getSuffix(baseHostname);\n  if (pathStyleEndpoint || !isDnsCompatibleBucketName(bucketName) || (tlsCompatible && DOT_PATTERN.test(bucketName))) {\n    return {\n      bucketEndpoint: false,\n      hostname: dualstackEndpoint ? `s3.dualstack.${clientRegion}.${hostnameSuffix}` : baseHostname,\n    };\n  }\n\n  if (accelerateEndpoint) {\n    baseHostname = `s3-accelerate${dualstackEndpoint ? \".dualstack\" : \"\"}.${hostnameSuffix}`;\n  } else if (dualstackEndpoint) {\n    baseHostname = `s3.dualstack.${clientRegion}.${hostnameSuffix}`;\n  }\n\n  return {\n    bucketEndpoint: true,\n    hostname: `${bucketName}.${baseHostname}`,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}