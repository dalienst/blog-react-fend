{"ast":null,"code":"import { __values, __spreadArray, __read } from './_virtual/_tslib.js';\nimport { flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\n\nfunction getAllChildren(stateNode) {\n  return Object.keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\n\nfunction getChildren(stateNode) {\n  return getAllChildren(stateNode).filter(function (sn) {\n    return sn.type !== 'history';\n  });\n}\n\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\n\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\n\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\n\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\n\nfunction nextEvents(configuration) {\n  return __spreadArray([], __read(new Set(flatten(__spreadArray([], __read(configuration.map(function (sn) {\n    return sn.ownEvents;\n  })), false)))), false);\n}\n\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\n\nfunction getMeta(configuration) {\n  if (configuration === void 0) {\n    configuration = [];\n  }\n\n  return configuration.reduce(function (acc, stateNode) {\n    if (stateNode.meta !== undefined) {\n      acc[stateNode.id] = stateNode.meta;\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction getTagsFromConfiguration(configuration) {\n  return new Set(flatten(configuration.map(function (sn) {\n    return sn.tags;\n  })));\n}\n\nexport { getAdjList, getAllChildren, getAllStateNodes, getChildren, getConfiguration, getMeta, getTagsFromConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };","map":{"version":3,"sources":["/home/dalienst/node_modules/xstate/es/stateUtils.js"],"names":["__values","__spreadArray","__read","flatten","isLeafNode","stateNode","type","getAllChildren","Object","keys","states","map","key","getChildren","filter","sn","getAllStateNodes","stateNodes","concat","getConfiguration","prevStateNodes","e_1","_a","e_2","_b","e_3","_c","e_4","_d","prevConfiguration","Set","prevAdjList","getAdjList","configuration","configuration_1","configuration_1_1","next","done","s","value","m","parent","has","add","e_1_1","error","return","call","adjList","configuration_2","configuration_2_1","get","length","forEach","initialStateNodes","_e","_f","child","e_3_1","e_2_1","configuration_3","configuration_3_1","e_4_1","getValueFromAdj","baseNode","childStateNodes","childStateNode","stateValue","csn","e_5","Map","configuration_4","configuration_4_1","set","push","e_5_1","getValue","rootNode","config","iterable","item","Array","isArray","some","member","nextEvents","ownEvents","isInFinalState","every","getMeta","reduce","acc","meta","undefined","id","getTagsFromConfiguration","tags"],"mappings":"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","sourcesContent":["import { __values, __spreadArray, __read } from './_virtual/_tslib.js';\nimport { flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\nfunction getAllChildren(stateNode) {\n  return Object.keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\nfunction getChildren(stateNode) {\n  return getAllChildren(stateNode).filter(function (sn) {\n    return sn.type !== 'history';\n  });\n}\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\nfunction nextEvents(configuration) {\n  return __spreadArray([], __read(new Set(flatten(__spreadArray([], __read(configuration.map(function (sn) {\n    return sn.ownEvents;\n  })), false)))), false);\n}\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\nfunction getMeta(configuration) {\n  if (configuration === void 0) {\n    configuration = [];\n  }\n\n  return configuration.reduce(function (acc, stateNode) {\n    if (stateNode.meta !== undefined) {\n      acc[stateNode.id] = stateNode.meta;\n    }\n\n    return acc;\n  }, {});\n}\nfunction getTagsFromConfiguration(configuration) {\n  return new Set(flatten(configuration.map(function (sn) {\n    return sn.tags;\n  })));\n}\n\nexport { getAdjList, getAllChildren, getAllStateNodes, getChildren, getConfiguration, getMeta, getTagsFromConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };\n"]},"metadata":{},"sourceType":"module"}