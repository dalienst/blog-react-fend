{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { Popup } from 'maplibre-gl';\nimport { ACTIVE_MARKER_COLOR, COLOR_WHITE, MARKER_COLOR } from \"./constants\";\nimport { createMarker } from \"./createMarker\";\nimport { getPopupRenderFunction } from \"./popupRender\";\nimport { isCoordinates } from \"./utils\";\nconst HIDE_TIP = \"amplify-tip\";\nexport function drawUnclusteredLayer(sourceName, map, _a) {\n  var {\n    showMarkerPopup = false\n  } = _a,\n      options = __rest(_a, [\"showMarkerPopup\"]);\n\n  const unclusteredLayerId = `${sourceName}-layer-unclustered-point`;\n  let selectedId = null;\n\n  function deselectPoint() {\n    if (selectedId !== null) {\n      map.setLayoutProperty(unclusteredLayerId, \"icon-image\", \"inactive-marker\");\n      selectedId = null;\n    }\n  }\n\n  const popupRender = options.popupRender ? options.popupRender : getPopupRenderFunction(unclusteredLayerId, options);\n  addUnclusteredMarkerImages(map, options);\n  const defaultUnclusteredPoint = {\n    id: unclusteredLayerId,\n    type: \"symbol\",\n    source: sourceName,\n    filter: [\"!\", [\"has\", \"point_count\"]],\n    layout: {\n      \"icon-image\": \"inactive-marker\"\n    }\n  };\n  map.addLayer(Object.assign({}, defaultUnclusteredPoint));\n  /*\n   * Add css to header to hide default popup tip\n   */\n\n  if (showMarkerPopup) {\n    const element = document.getElementById(HIDE_TIP);\n\n    if (!element) {\n      const style = document.createElement(\"style\");\n      style.setAttribute(\"id\", HIDE_TIP);\n      document.head.append(style);\n      style.textContent = \".mapboxgl-popup-tip { display: none; }\";\n    }\n  }\n\n  map.on(\"click\", function () {\n    deselectPoint();\n  });\n  /*\n   * Set active state on markers when clicked\n   */\n\n  map.on(\"click\", unclusteredLayerId, function (e) {\n    if (typeof options.onClick === \"function\") options.onClick(e);\n    selectedId = e.features[0].id;\n    map.setLayoutProperty(unclusteredLayerId, \"icon-image\", [\"match\", [\"id\"], selectedId, \"active-marker\", \"inactive-marker\" // default\n    ]); // If popup option is set show a popup on click\n\n    if (showMarkerPopup) {\n      const selectedFeature = e.features[0];\n      const coordinates = selectedFeature.geometry.coordinates;\n\n      if (isCoordinates(coordinates)) {\n        const popup = new Popup().setLngLat(coordinates).setHTML(popupRender(selectedFeature)).setOffset(15).addTo(map);\n        popup.on(\"close\", function () {\n          if (selectedId === selectedFeature.id) deselectPoint();\n        });\n      }\n    }\n  });\n  /*\n   * Set cursor style to pointer when mousing over point layer\n   */\n\n  map.on(\"mouseover\", unclusteredLayerId, function () {\n    map.getCanvas().style.cursor = \"pointer\";\n  });\n  /*\n   * Reset cursor style when the point layer\n   */\n\n  map.on(\"mouseleave\", unclusteredLayerId, () => {\n    map.getCanvas().style.cursor = \"\";\n  });\n  return {\n    unclusteredLayerId\n  };\n}\n/*\n * Adds marker images to the maplibre canvas to be used for rendering unclustered points\n */\n\nfunction addUnclusteredMarkerImages(map, _ref) {\n  let {\n    selectedColor = ACTIVE_MARKER_COLOR,\n    selectedBorderColor = COLOR_WHITE,\n    selectedBorderWidth = 4,\n    defaultBorderColor = COLOR_WHITE,\n    defaultBorderWidth = 4,\n    defaultColor: fillColor = MARKER_COLOR,\n    markerImageElement,\n    activeMarkerImageElement\n  } = _ref;\n  const inactiveMarker = markerImageElement || createMarker({\n    fillColor: fillColor,\n    strokeColor: defaultBorderColor,\n    lineWidth: defaultBorderWidth\n  });\n  const activeMarker = activeMarkerImageElement || markerImageElement || createMarker({\n    fillColor: selectedColor,\n    strokeColor: selectedBorderColor,\n    lineWidth: selectedBorderWidth\n  });\n  map.addImage(\"inactive-marker\", inactiveMarker, {\n    pixelRatio: 2\n  });\n  map.addImage(\"active-marker\", activeMarker, {\n    pixelRatio: 2\n  });\n}","map":{"version":3,"sources":["/home/dalienst/node_modules/maplibre-gl-js-amplify/lib/esm/drawUnclusteredLayer.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","Popup","ACTIVE_MARKER_COLOR","COLOR_WHITE","MARKER_COLOR","createMarker","getPopupRenderFunction","isCoordinates","HIDE_TIP","drawUnclusteredLayer","sourceName","map","_a","showMarkerPopup","options","unclusteredLayerId","selectedId","deselectPoint","setLayoutProperty","popupRender","addUnclusteredMarkerImages","defaultUnclusteredPoint","id","type","source","filter","layout","addLayer","assign","element","document","getElementById","style","createElement","setAttribute","head","append","textContent","on","onClick","features","selectedFeature","coordinates","geometry","popup","setLngLat","setHTML","setOffset","addTo","getCanvas","cursor","selectedColor","selectedBorderColor","selectedBorderWidth","defaultBorderColor","defaultBorderWidth","defaultColor","fillColor","markerImageElement","activeMarkerImageElement","inactiveMarker","strokeColor","lineWidth","activeMarker","addImage","pixelRatio"],"mappings":"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","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { Popup } from 'maplibre-gl';\nimport { ACTIVE_MARKER_COLOR, COLOR_WHITE, MARKER_COLOR } from \"./constants\";\nimport { createMarker } from \"./createMarker\";\nimport { getPopupRenderFunction } from \"./popupRender\";\nimport { isCoordinates } from \"./utils\";\nconst HIDE_TIP = \"amplify-tip\";\nexport function drawUnclusteredLayer(sourceName, map, _a) {\n    var { showMarkerPopup = false } = _a, options = __rest(_a, [\"showMarkerPopup\"]);\n    const unclusteredLayerId = `${sourceName}-layer-unclustered-point`;\n    let selectedId = null;\n    function deselectPoint() {\n        if (selectedId !== null) {\n            map.setLayoutProperty(unclusteredLayerId, \"icon-image\", \"inactive-marker\");\n            selectedId = null;\n        }\n    }\n    const popupRender = options.popupRender\n        ? options.popupRender\n        : getPopupRenderFunction(unclusteredLayerId, options);\n    addUnclusteredMarkerImages(map, options);\n    const defaultUnclusteredPoint = {\n        id: unclusteredLayerId,\n        type: \"symbol\",\n        source: sourceName,\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        layout: {\n            \"icon-image\": \"inactive-marker\",\n        },\n    };\n    map.addLayer(Object.assign({}, defaultUnclusteredPoint));\n    /*\n     * Add css to header to hide default popup tip\n     */\n    if (showMarkerPopup) {\n        const element = document.getElementById(HIDE_TIP);\n        if (!element) {\n            const style = document.createElement(\"style\");\n            style.setAttribute(\"id\", HIDE_TIP);\n            document.head.append(style);\n            style.textContent = \".mapboxgl-popup-tip { display: none; }\";\n        }\n    }\n    map.on(\"click\", function () {\n        deselectPoint();\n    });\n    /*\n     * Set active state on markers when clicked\n     */\n    map.on(\"click\", unclusteredLayerId, function (e) {\n        if (typeof options.onClick === \"function\")\n            options.onClick(e);\n        selectedId = e.features[0].id;\n        map.setLayoutProperty(unclusteredLayerId, \"icon-image\", [\n            \"match\",\n            [\"id\"],\n            selectedId,\n            \"active-marker\",\n            \"inactive-marker\", // default\n        ]);\n        // If popup option is set show a popup on click\n        if (showMarkerPopup) {\n            const selectedFeature = e.features[0];\n            const coordinates = selectedFeature.geometry.coordinates;\n            if (isCoordinates(coordinates)) {\n                const popup = new Popup()\n                    .setLngLat(coordinates)\n                    .setHTML(popupRender(selectedFeature))\n                    .setOffset(15)\n                    .addTo(map);\n                popup.on(\"close\", function () {\n                    if (selectedId === selectedFeature.id)\n                        deselectPoint();\n                });\n            }\n        }\n    });\n    /*\n     * Set cursor style to pointer when mousing over point layer\n     */\n    map.on(\"mouseover\", unclusteredLayerId, function () {\n        map.getCanvas().style.cursor = \"pointer\";\n    });\n    /*\n     * Reset cursor style when the point layer\n     */\n    map.on(\"mouseleave\", unclusteredLayerId, () => {\n        map.getCanvas().style.cursor = \"\";\n    });\n    return { unclusteredLayerId };\n}\n/*\n * Adds marker images to the maplibre canvas to be used for rendering unclustered points\n */\nfunction addUnclusteredMarkerImages(map, { selectedColor = ACTIVE_MARKER_COLOR, selectedBorderColor = COLOR_WHITE, selectedBorderWidth = 4, defaultBorderColor = COLOR_WHITE, defaultBorderWidth = 4, defaultColor: fillColor = MARKER_COLOR, markerImageElement, activeMarkerImageElement, }) {\n    const inactiveMarker = markerImageElement ||\n        createMarker({\n            fillColor: fillColor,\n            strokeColor: defaultBorderColor,\n            lineWidth: defaultBorderWidth,\n        });\n    const activeMarker = activeMarkerImageElement ||\n        markerImageElement ||\n        createMarker({\n            fillColor: selectedColor,\n            strokeColor: selectedBorderColor,\n            lineWidth: selectedBorderWidth,\n        });\n    map.addImage(\"inactive-marker\", inactiveMarker, { pixelRatio: 2 });\n    map.addImage(\"active-marker\", activeMarker, { pixelRatio: 2 });\n}\n"]},"metadata":{},"sourceType":"module"}