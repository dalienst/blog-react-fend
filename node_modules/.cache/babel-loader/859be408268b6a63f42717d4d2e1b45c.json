{"ast":null,"code":"import { __awaiter as e, __generator as n } from \"tslib\";\nimport { Auth as t } from \"aws-amplify\";\nimport r from \"lodash/get\";\nimport i from \"lodash/pickBy\";\nimport { createMachine as a, sendUpdate as s, assign as o } from \"xstate\";\nimport { runValidators as d } from \"../../validators/index.js\";\nimport { clearError as c, clearFormValues as u, clearTouched as l, clearValidationError as m, handleInput as p, handleSubmit as g, handleBlur as f, parsePhoneNumber as v, setCredentials as U, setFieldErrors as h, setRemoteError as S, setCodeDeliveryDetails as E, setUser as I } from \"./actions.js\";\n\nfunction y(y) {\n  var C = y.services;\n  return a({\n    id: \"signUpActor\",\n    initial: \"init\",\n    predictableActionArguments: !0,\n    states: {\n      init: {\n        always: [{\n          target: \"confirmSignUp\",\n          cond: \"shouldInitConfirmSignUp\"\n        }, {\n          target: \"signUp\"\n        }]\n      },\n      signUp: {\n        type: \"parallel\",\n        exit: [\"clearError\", \"clearFormValues\", \"clearTouched\"],\n        states: {\n          validation: {\n            initial: \"pending\",\n            states: {\n              pending: {\n                invoke: {\n                  src: \"validateSignUp\",\n                  onDone: {\n                    target: \"valid\",\n                    actions: \"clearValidationError\"\n                  },\n                  onError: {\n                    target: \"invalid\",\n                    actions: \"setFieldErrors\"\n                  }\n                }\n              },\n              valid: {\n                entry: \"sendUpdate\"\n              },\n              invalid: {\n                entry: \"sendUpdate\"\n              }\n            },\n            on: {\n              CHANGE: {\n                actions: \"handleInput\",\n                target: \".pending\"\n              },\n              BLUR: {\n                actions: \"handleBlur\",\n                target: \".pending\"\n              }\n            }\n          },\n          submission: {\n            initial: \"idle\",\n            states: {\n              idle: {\n                entry: \"sendUpdate\",\n                on: {\n                  SUBMIT: {\n                    actions: \"handleSubmit\",\n                    target: \"validate\"\n                  },\n                  FEDERATED_SIGN_IN: \"federatedSignIn\"\n                }\n              },\n              federatedSignIn: {\n                tags: [\"pending\"],\n                entry: [\"sendUpdate\", \"clearError\"],\n                invoke: {\n                  src: \"federatedSignIn\",\n                  onDone: \"#signUpActor.resolved\",\n                  onError: {\n                    actions: \"setRemoteError\"\n                  }\n                }\n              },\n              validate: {\n                entry: \"sendUpdate\",\n                invoke: {\n                  src: \"validateSignUp\",\n                  onDone: {\n                    target: \"pending\",\n                    actions: \"clearValidationError\"\n                  },\n                  onError: {\n                    target: \"idle\",\n                    actions: \"setFieldErrors\"\n                  }\n                }\n              },\n              pending: {\n                tags: [\"pending\"],\n                entry: [\"parsePhoneNumber\", \"sendUpdate\", \"clearError\"],\n                invoke: {\n                  src: \"signUp\",\n                  onDone: [{\n                    cond: \"shouldSkipConfirm\",\n                    target: \"skipConfirm\",\n                    actions: [\"setUser\", \"setCredentials\"]\n                  }, {\n                    target: \"resolved\",\n                    actions: [\"setUser\", \"setCredentials\", \"setCodeDeliveryDetails\"]\n                  }],\n                  onError: {\n                    target: \"idle\",\n                    actions: \"setRemoteError\"\n                  }\n                }\n              },\n              skipConfirm: {\n                always: {\n                  target: \"#signUpActor.resolved\",\n                  actions: \"setAutoSignInIntent\"\n                }\n              },\n              resolved: {\n                type: \"final\",\n                always: \"#signUpActor.confirmSignUp\"\n              }\n            }\n          }\n        }\n      },\n      confirmSignUp: {\n        initial: \"edit\",\n        states: {\n          edit: {\n            entry: \"sendUpdate\",\n            on: {\n              SUBMIT: {\n                actions: \"handleSubmit\",\n                target: \"submit\"\n              },\n              CHANGE: {\n                actions: \"handleInput\"\n              },\n              BLUR: {\n                actions: \"handleBlur\"\n              },\n              RESEND: \"resend\"\n            }\n          },\n          resend: {\n            tags: [\"pending\"],\n            entry: \"sendUpdate\",\n            invoke: {\n              src: \"resendConfirmationCode\",\n              onDone: {\n                target: \"edit\"\n              },\n              onError: [{\n                target: \"#signUpActor.resolved\",\n                actions: \"setAutoSignInIntent\",\n                cond: \"isUserAlreadyConfirmed\"\n              }, {\n                target: \"edit\",\n                actions: \"setRemoteError\"\n              }]\n            }\n          },\n          submit: {\n            tags: [\"pending\"],\n            entry: [\"sendUpdate\", \"clearError\"],\n            invoke: {\n              src: \"confirmSignUp\",\n              onDone: {\n                target: \"#signUpActor.resolved\",\n                actions: \"setAutoSignInIntent\"\n              },\n              onError: {\n                target: \"edit\",\n                actions: \"setRemoteError\"\n              }\n            }\n          }\n        }\n      },\n      resolved: {\n        type: \"final\",\n        data: function (e, n) {\n          var t = e.authAttributes,\n              i = t.username,\n              a = t.password;\n          return {\n            user: r(n, \"data.user\") || e.user,\n            authAttributes: {\n              username: i,\n              password: a\n            },\n            intent: e.intent\n          };\n        }\n      }\n    }\n  }, {\n    guards: {\n      isUserAlreadyConfirmed: function (e, n) {\n        return \"User is already confirmed.\" === n.data.message;\n      },\n      shouldInitConfirmSignUp: function (e) {\n        return e.intent && \"confirmSignUp\" === e.intent;\n      },\n      shouldSkipConfirm: function (e, n) {\n        return n.data.userConfirmed;\n      }\n    },\n    actions: {\n      clearError: c,\n      clearFormValues: u,\n      clearTouched: l,\n      clearValidationError: m,\n      handleInput: p,\n      handleSubmit: g,\n      handleBlur: f,\n      parsePhoneNumber: v,\n      setCredentials: U,\n      setFieldErrors: h,\n      setRemoteError: S,\n      setCodeDeliveryDetails: E,\n      setUser: I,\n      sendUpdate: s(),\n      setAutoSignInIntent: o({\n        intent: function (e) {\n          return \"confirmSignUp\" === (null == e ? void 0 : e.intent) ? \"autoSignInSubmit\" : \"autoSignIn\";\n        }\n      })\n    },\n    services: {\n      confirmSignUp: function (t, i) {\n        return e(this, void 0, void 0, function () {\n          var e, i, a, s, o;\n          return n(this, function (n) {\n            switch (n.label) {\n              case 0:\n                return e = t.user, i = t.authAttributes, a = t.formValues, s = a.confirmation_code, o = r(e, \"username\") || r(i, \"username\"), [4, C.handleConfirmSignUp({\n                  username: o,\n                  code: s\n                })];\n\n              case 1:\n                return [2, n.sent()];\n            }\n          });\n        });\n      },\n      resendConfirmationCode: function (i, a) {\n        return e(this, void 0, void 0, function () {\n          var e, a, s;\n          return n(this, function (n) {\n            return e = i.user, a = i.authAttributes, s = r(e, \"username\") || r(a, \"username\"), [2, t.resendSignUp(s)];\n          });\n        });\n      },\n      federatedSignIn: function (r, i) {\n        return e(this, void 0, void 0, function () {\n          var e;\n          return n(this, function (n) {\n            switch (n.label) {\n              case 0:\n                return e = i.data.provider, [4, t.federatedSignIn({\n                  provider: e\n                })];\n\n              case 1:\n                return [2, n.sent()];\n            }\n          });\n        });\n      },\n      signUp: function (t, r) {\n        return e(this, void 0, void 0, function () {\n          var e, r, a, s, o, d, c;\n          return n(this, function (n) {\n            switch (n.label) {\n              case 0:\n                return e = t.formValues, r = t.loginMechanisms, a = r[0], o = (s = e)[void 0 === a ? \"username\" : a], d = s.password, c = i(e, function (e, n) {\n                  switch (n) {\n                    case \"address\":\n                    case \"birthdate\":\n                    case \"email\":\n                    case \"family_name\":\n                    case \"gender\":\n                    case \"given_name\":\n                    case \"locale\":\n                    case \"middle_name\":\n                    case \"name\":\n                    case \"nickname\":\n                    case \"phone_number\":\n                    case \"picture\":\n                    case \"preferred_username\":\n                    case \"profile\":\n                    case \"updated_at\":\n                    case \"website\":\n                    case \"zoneinfo\":\n                      return !0;\n\n                    default:\n                      return n.startsWith(\"custom:\");\n                  }\n                }), [4, C.handleSignUp({\n                  username: o,\n                  password: d,\n                  attributes: c\n                })];\n\n              case 1:\n                return [2, n.sent()];\n            }\n          });\n        });\n      },\n      validateSignUp: function (t, r) {\n        return e(this, void 0, void 0, function () {\n          return n(this, function (e) {\n            return [2, d(t.formValues, t.touched, t.passwordSettings, [C.validateFormPassword, C.validateConfirmPassword, C.validatePreferredUsername, C.validateCustomSignUp])];\n          });\n        });\n      }\n    }\n  });\n}\n\nexport { y as createSignUpMachine };","map":{"version":3,"sources":["/home/dalienst/node_modules/@aws-amplify/ui/dist/esm/machines/authenticator/signUp.js"],"names":["__awaiter","e","__generator","n","Auth","t","r","i","createMachine","a","sendUpdate","s","assign","o","runValidators","d","clearError","c","clearFormValues","u","clearTouched","l","clearValidationError","m","handleInput","p","handleSubmit","g","handleBlur","f","parsePhoneNumber","v","setCredentials","U","setFieldErrors","h","setRemoteError","S","setCodeDeliveryDetails","E","setUser","I","y","C","services","id","initial","predictableActionArguments","states","init","always","target","cond","signUp","type","exit","validation","pending","invoke","src","onDone","actions","onError","valid","entry","invalid","on","CHANGE","BLUR","submission","idle","SUBMIT","FEDERATED_SIGN_IN","federatedSignIn","tags","validate","skipConfirm","resolved","confirmSignUp","edit","RESEND","resend","submit","data","authAttributes","username","password","user","intent","guards","isUserAlreadyConfirmed","message","shouldInitConfirmSignUp","shouldSkipConfirm","userConfirmed","setAutoSignInIntent","label","formValues","confirmation_code","handleConfirmSignUp","code","sent","resendConfirmationCode","resendSignUp","provider","loginMechanisms","startsWith","handleSignUp","attributes","validateSignUp","touched","passwordSettings","validateFormPassword","validateConfirmPassword","validatePreferredUsername","validateCustomSignUp","createSignUpMachine"],"mappings":"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","sourcesContent":["import{__awaiter as e,__generator as n}from\"tslib\";import{Auth as t}from\"aws-amplify\";import r from\"lodash/get\";import i from\"lodash/pickBy\";import{createMachine as a,sendUpdate as s,assign as o}from\"xstate\";import{runValidators as d}from\"../../validators/index.js\";import{clearError as c,clearFormValues as u,clearTouched as l,clearValidationError as m,handleInput as p,handleSubmit as g,handleBlur as f,parsePhoneNumber as v,setCredentials as U,setFieldErrors as h,setRemoteError as S,setCodeDeliveryDetails as E,setUser as I}from\"./actions.js\";function y(y){var C=y.services;return a({id:\"signUpActor\",initial:\"init\",predictableActionArguments:!0,states:{init:{always:[{target:\"confirmSignUp\",cond:\"shouldInitConfirmSignUp\"},{target:\"signUp\"}]},signUp:{type:\"parallel\",exit:[\"clearError\",\"clearFormValues\",\"clearTouched\"],states:{validation:{initial:\"pending\",states:{pending:{invoke:{src:\"validateSignUp\",onDone:{target:\"valid\",actions:\"clearValidationError\"},onError:{target:\"invalid\",actions:\"setFieldErrors\"}}},valid:{entry:\"sendUpdate\"},invalid:{entry:\"sendUpdate\"}},on:{CHANGE:{actions:\"handleInput\",target:\".pending\"},BLUR:{actions:\"handleBlur\",target:\".pending\"}}},submission:{initial:\"idle\",states:{idle:{entry:\"sendUpdate\",on:{SUBMIT:{actions:\"handleSubmit\",target:\"validate\"},FEDERATED_SIGN_IN:\"federatedSignIn\"}},federatedSignIn:{tags:[\"pending\"],entry:[\"sendUpdate\",\"clearError\"],invoke:{src:\"federatedSignIn\",onDone:\"#signUpActor.resolved\",onError:{actions:\"setRemoteError\"}}},validate:{entry:\"sendUpdate\",invoke:{src:\"validateSignUp\",onDone:{target:\"pending\",actions:\"clearValidationError\"},onError:{target:\"idle\",actions:\"setFieldErrors\"}}},pending:{tags:[\"pending\"],entry:[\"parsePhoneNumber\",\"sendUpdate\",\"clearError\"],invoke:{src:\"signUp\",onDone:[{cond:\"shouldSkipConfirm\",target:\"skipConfirm\",actions:[\"setUser\",\"setCredentials\"]},{target:\"resolved\",actions:[\"setUser\",\"setCredentials\",\"setCodeDeliveryDetails\"]}],onError:{target:\"idle\",actions:\"setRemoteError\"}}},skipConfirm:{always:{target:\"#signUpActor.resolved\",actions:\"setAutoSignInIntent\"}},resolved:{type:\"final\",always:\"#signUpActor.confirmSignUp\"}}}}},confirmSignUp:{initial:\"edit\",states:{edit:{entry:\"sendUpdate\",on:{SUBMIT:{actions:\"handleSubmit\",target:\"submit\"},CHANGE:{actions:\"handleInput\"},BLUR:{actions:\"handleBlur\"},RESEND:\"resend\"}},resend:{tags:[\"pending\"],entry:\"sendUpdate\",invoke:{src:\"resendConfirmationCode\",onDone:{target:\"edit\"},onError:[{target:\"#signUpActor.resolved\",actions:\"setAutoSignInIntent\",cond:\"isUserAlreadyConfirmed\"},{target:\"edit\",actions:\"setRemoteError\"}]}},submit:{tags:[\"pending\"],entry:[\"sendUpdate\",\"clearError\"],invoke:{src:\"confirmSignUp\",onDone:{target:\"#signUpActor.resolved\",actions:\"setAutoSignInIntent\"},onError:{target:\"edit\",actions:\"setRemoteError\"}}}}},resolved:{type:\"final\",data:function(e,n){var t=e.authAttributes,i=t.username,a=t.password;return{user:r(n,\"data.user\")||e.user,authAttributes:{username:i,password:a},intent:e.intent}}}}},{guards:{isUserAlreadyConfirmed:function(e,n){return\"User is already confirmed.\"===n.data.message},shouldInitConfirmSignUp:function(e){return e.intent&&\"confirmSignUp\"===e.intent},shouldSkipConfirm:function(e,n){return n.data.userConfirmed}},actions:{clearError:c,clearFormValues:u,clearTouched:l,clearValidationError:m,handleInput:p,handleSubmit:g,handleBlur:f,parsePhoneNumber:v,setCredentials:U,setFieldErrors:h,setRemoteError:S,setCodeDeliveryDetails:E,setUser:I,sendUpdate:s(),setAutoSignInIntent:o({intent:function(e){return\"confirmSignUp\"===(null==e?void 0:e.intent)?\"autoSignInSubmit\":\"autoSignIn\"}})},services:{confirmSignUp:function(t,i){return e(this,void 0,void 0,(function(){var e,i,a,s,o;return n(this,(function(n){switch(n.label){case 0:return e=t.user,i=t.authAttributes,a=t.formValues,s=a.confirmation_code,o=r(e,\"username\")||r(i,\"username\"),[4,C.handleConfirmSignUp({username:o,code:s})];case 1:return[2,n.sent()]}}))}))},resendConfirmationCode:function(i,a){return e(this,void 0,void 0,(function(){var e,a,s;return n(this,(function(n){return e=i.user,a=i.authAttributes,s=r(e,\"username\")||r(a,\"username\"),[2,t.resendSignUp(s)]}))}))},federatedSignIn:function(r,i){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=i.data.provider,[4,t.federatedSignIn({provider:e})];case 1:return[2,n.sent()]}}))}))},signUp:function(t,r){return e(this,void 0,void 0,(function(){var e,r,a,s,o,d,c;return n(this,(function(n){switch(n.label){case 0:return e=t.formValues,r=t.loginMechanisms,a=r[0],o=(s=e)[void 0===a?\"username\":a],d=s.password,c=i(e,(function(e,n){switch(n){case\"address\":case\"birthdate\":case\"email\":case\"family_name\":case\"gender\":case\"given_name\":case\"locale\":case\"middle_name\":case\"name\":case\"nickname\":case\"phone_number\":case\"picture\":case\"preferred_username\":case\"profile\":case\"updated_at\":case\"website\":case\"zoneinfo\":return!0;default:return n.startsWith(\"custom:\")}})),[4,C.handleSignUp({username:o,password:d,attributes:c})];case 1:return[2,n.sent()]}}))}))},validateSignUp:function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,d(t.formValues,t.touched,t.passwordSettings,[C.validateFormPassword,C.validateConfirmPassword,C.validatePreferredUsername,C.validateCustomSignUp])]}))}))}}})}export{y as createSignUpMachine};\n"]},"metadata":{},"sourceType":"module"}